{% extends "base.html" %}
{% block head %}
<title>{{ mod.capitalize() }} View Page</title>
{% endblock %}

{% block header %}
{{ super() }}
<h1>
  {{ mod.capitalize() }} Details
  {% if data.name %}for {{ data.name }}{% endif %}
</h1>
{% endblock header %}
{% block content %}

{% block data_view %}
<ul>
{% for key in data.keys() %}
  {% if key == 'insights' and data[key]|length %}
  <li><a href="{{ url_for('insights', mod=mod, id=data.id) }}">See Insights</a> </li>
  {% elif key == 'aud_count' %}
  <li>
    audience count: {% for ea in data[key] %}{{ea}}, {% else %}EMPTY NONE{% endfor %}
  </li>
  {% elif key == 'posts' and data[key]|length %}
  <li>
    <button aria-expanded="false">
      {{ key }}
      <svg viewBox="0 0 10 10" aria-hidden="true" focusable="false">
        <rect class="vert" height="8" width="2" y="1" x="4" />
        <rect height="2" width="8" y="4" x="1" />
      </svg>
    </button>
    <ul class="{{ key }}">
    {% for ea in data[key] %}
      <li>
        <a href="{{ url_for('view', mod='post', id=ea.id) }}"># {{ea.id}} {{ea.media_type}} posted on {{ea.recorded}}</a>
      </li>
    {% endfor %}
    </ul>
  </li>
  {% elif key == 'audiences' and data[key]|length %}
  <li> {{ key }}
    <ul class="{{ key }}">
    {% for ea in data[key] %}
      <li>
        <a href="{{ url_for('view', mod='audience', id=ea.id) }}">
        {{ ea.name }} as of {{ea.recorded}}</a>
      </li>
    {% endfor %}
    </ul>
  </li>
  {% elif key in ['facebook_id', 'instagram_id'] %}
  <li>{{key}}: {%if data[key] is none %} Not {% endif %} Known</li>
  {% else %}
  <li>
    {{key}}:
    {% if data[key] is iterable and data[key] is not string %}
      {% if data[key]|length %}
      <ul class="{{ key }}">{% for ea in data[key] %}<li>{{ ea }}</li>{% endfor %}</ul>
      {% else %}
      EMPTY NONE
      {% endif %}
    {% else %}
    {{data[key]}}
    {% endif %}
  </li>
  {% endif %}
{% else %}
  <li>NO DATA</li>
{% endfor %}
</ul>
{% endblock data_view %}

{% block modify %}
{% if mod in ['influencer', 'brand', 'admin', 'manager', 'campaign', 'insight', 'audience'] %}
<h3>Change Data Actions</h3>
<ul>
  {% if mod in ['influencer', 'brand'] and data['instagram_id'] %}
  <li><a href="{{ url_for('new_post', mod=mod, id=data.id) }}">Get New Media / Posts</a> </li>
  <li><a href="{{ url_for('new_insight', mod=mod, id=data.id) }}">Get New {{mod|title}} Insights</a> </li>
  <li><a href="{{ url_for('new_audience', mod=mod, id=data.id) }}">Get New Audience Data</a> </li>
  {% endif %}
  <li>CAREFUL BELOW!</li>
  <li><a href="{{ url_for('edit', mod=mod, id=data.id) }}">Update {{ mod|title }}</a></li>
  {% if current_user.role == 'admin' or (current_user.id == data.id and current_user.role == mod) %}
  <li><a href="{{ url_for('delete', mod=mod, id=data.id) }}">Delete {{ mod|title }}</a></li>
  {% endif %}
  {% if current_user.role == 'admin' %}
  <li><a href="{{ url_for('export', mod=mod, id=data.id)}}">Export Data to a Google Sheet</a></li>
  {% endif %}
</ul>
{% endif %}
{% endblock modify %}
<script>
  (function() {
    const headings = document.querySelectorAll('h2');

    Array.prototype.forEach.call(headings, h => {
      let btn = h.querySelector('button');
      let target = h.nextElementSibling;

      btn.onclick = () => {
        let expanded = btn.getAttribute('aria-expanded') === 'true';

        btn.setAttribute('aria-expanded', !expanded);
        target.hidden = expanded;
      }
    });
  })()
</script>
{% endblock content %}
